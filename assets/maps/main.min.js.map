{"version":3,"sources":["main.js"],"names":["asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","arguments","apply","err","undefined","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","_objectSpread","target","i","length","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","configurable","writable","SUBSETS_PANGRAMS","RTL_SUBSETS","WEIGHT_NAME","VARIANTS_EXPLICATION","reloadPage","getFetchResponse","setLoader","sortVariants","IndDB","GWHelper","constructor","options","upgrade","e","db","result","onerror","console","oldVersion","store","createObjectStore","available_fonts_store_name","keyPath","createIndex","unique","multiEntry","downloaded_fonts_store_name","success","onversionchange","close","warn","db_name","db_version","assign","init","indDB","_ref","open_btn","document","querySelector","delete_btn","togglePlugin","disable","enable","setAttribute","addEventListener","open_db_options","response","catch","message","once","removeAttribute","_initAction","indexedDB","databases","name","version","dispatchEvent","Event","action","_findVariables","_findElements","mainHandler","_createAvailableFontsList","_attachEvents","_createDownloadedFontsList","list","log","finally","transaction","_transaction","objectStore","count","onsuccess","contentHandler","data","setStoreData","search_fieldset","available_fonts_list_items","search_input","available_fonts_list","innerHTML","count_items","main_holder","GWH_url","font_detalis_id_prefix","fonts_path","search_form","subset_select","category_select","downloaded_fonts_list","observer","IntersectionObserver","entries","entry","isIntersecting","head","insertAdjacentHTML","concat","dataset","query","unobserve","rootMargin","categories","Set","subsets","createItem","variants","defVariant","includes","getVariants","subsets_text","s","add","subset_class","getSubsetsText","link","createElement","className","href","id","family","details","item","style","fontFamily","split","join","append","observe","store_name","openCursor","cursor","category","continue","prefix","categories_options","sort","a","b","localeCompare","map","c","Option","reverse","subsets_options","searchFonts","searchInKeys","fragment","createDocumentFragment","matches","toLowerCase","appendChild","evt","getAllData","onchange","condition","selectedIndex","index","classList","startsWith","remove","elem","values","contains","onreset","onclick","closest","preventDefault","_createFontFamily","_this","parentElement","font_id","font_details","getAttribute","subsetsCheckboxes","checkbox","type","defSubset","label","innerText","prepend","variantItem","v","fieldset","color","stopPropagation","_downloadFont","variation_title","fontWeight","fontStyle","subset","text","some","rtl","r","checkboxes","variantsList","subsets_checkboxes","familyDOM","wghts","endsWith","familyCss","childNodes","n","window","scroll","top","scrollY","getBoundingClientRect","getElementById","offsetHeight","left","behavior","variant","checked_subsets","call","control","checked","request","font","replace","get_store","complete","get","result_subsets","files","put","downloaded_font_face","downloaded_fonts_list_items","fonts","var_del_link","title","location","origin","delete","var_title","font_face_variant","_ref3","weight","font_face","FontFace","String","display","count_variants","fam_del_link","f","flat","open_close_link","Array","from","querySelectorAll","l","hasAttribute","load","loaded_face"],"mappings":"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","file":"../js/main.min.js","sourcesContent":["'use strict';\r\n\r\nimport {SUBSETS_PANGRAMS, RTL_SUBSETS, WEIGHT_NAME, VARIANTS_EXPLICATION} from './modules/constants.min.js';\r\nimport {reloadPage, getFetchResponse, setLoader, sortVariants} from './modules/helpers.min.js';\r\nimport {IndDB} from './modules/indexeddb.min.js';\r\n\r\n\r\nclass GWHelper {\r\n\t\r\n\t/** private const */\r\n\topen_db_options = {\r\n\t\tupgrade: (e, obj) => {\r\n\t\t\tlet db = e.target.result;\r\n\t\t\tdb.onerror = (err) => console.error('ERROR IN \"REQUEST_DB.onupgradeneeded\": ', err.target.error || err);\r\n\t\t\tif (e.oldVersion < 1) {\r\n\t\t\t\tlet store = db.createObjectStore(this.options.available_fonts_store_name, {keyPath: 'id'});\r\n\t\t\t\tstore.createIndex(\"family\", \"family\", {unique: true});\r\n\t\t\t\t// store.createIndex(\"variants\", \"variants\", {unique: false});\r\n\t\t\t\tstore.createIndex(\"subsets\", \"subsets\", {unique: false, multiEntry: true});\r\n\t\t\t\tstore.createIndex(\"category\", \"category\", {unique: false});\r\n\t\t\t\t// store.createIndex(\"defSubset\", \"defSubset\", {unique: false});\r\n\t\t\t\t// store.createIndex(\"defVariant\", \"defVariant\", {unique: false});\r\n\t\t\t\t\r\n\t\t\t\tstore = db.createObjectStore(this.options.downloaded_fonts_store_name, {keyPath: 'id'});\r\n\t\t\t\tstore.createIndex(\"variants\", \"variants\", {unique: false, multiEntry: true});\r\n\t\t\t}\r\n\t\t},\r\n\t\tsuccess: (e) => {\r\n\t\t\tlet db = e.target.result;\r\n\t\t\t/** TODO: display in warnings */\r\n\t\t\tdb.onerror = (err) => console.error('ERROR IN \"REQUEST_DB.onsuccess\": ', err.target.error || err);\r\n\t\t\tdb.onversionchange = () => {\r\n\t\t\t\tdb.close();\r\n\t\t\t\tconsole.warn('%cThe database is out of date 👴 please reload the page.', 'color:red;font-size:30px');\r\n\t\t\t\treloadPage();\r\n\t\t\t}\r\n\t\t\treturn db;\r\n\t\t}\r\n\t}\r\n\t\r\n\tconstructor(options) {\r\n\t\tthis.options = {\r\n\t\t\tavailable_fonts_store_name: 'available_fonts',\r\n\t\t\tdownloaded_fonts_store_name: 'downloaded_fonts',\r\n\t\t\tdb_name: 'fontsDB',\r\n\t\t\tdb_version: 1,\r\n\t\t}\r\n\t\tObject.assign(this.options, options);\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tinit() {\r\n\t\t/**\r\n\t\t * Using Object Destructuring and Property Shorthand 👏👏👏\r\n\t\t * https://stackoverflow.com/questions/17781472/how-to-get-a-subset-of-a-javascript-objects-properties\r\n\t\t * ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓\r\n\t\t * */\r\n\t\tthis.indDB = new IndDB((({db_name, db_version}) => ({db_name, db_version}))(this.options));\r\n\t\tthis.open_btn = document.querySelector(this.options.open_btn || '#GWH_open_btn');\r\n\t\tthis.delete_btn = document.querySelector(this.options.delete_btn || '#GWH_delete_btn');\r\n\t\t\r\n\t\tlet togglePlugin = (disable, enable) => {\r\n\t\t\tsetLoader();\r\n\t\t\tthis[disable +'_btn'].setAttribute('disabled', 'disabled');\r\n\t\t\tthis[enable +'_btn'].addEventListener('click', () => {\r\n\t\t\t\tthis.indDB[enable](this.open_db_options)\r\n\t\t\t\t\t.then(response => {\r\n\t\t\t\t\t\ttogglePlugin(enable, disable);\r\n\t\t\t\t\t\tconsole.info(response)\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\tconsole.error(err.message)\r\n\t\t\t\t\t});\r\n\t\t\t}, {once: true});\r\n\t\t\tthis[enable +'_btn'].removeAttribute('disabled');\r\n\t\t\tthis._initAction(disable);\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * Проверка на существование базы данных и если нет, вывод кнопки с запуском плагина\r\n\t\t * по событию click с дальнейшим отключением кнопки\r\n\t\t * TODO: возможно поменять способ инит при загрузке с существующей базой\r\n\t\t * */\r\n\t\tindexedDB.databases()\r\n\t\t\t.then(response => {\r\n\t\t\t\ttogglePlugin('delete', 'open');\r\n\t\t\t\tif (!!(response.filter(db => db.name === this.options.db_name && db.version === this.options.db_version)).length) {\r\n\t\t\t\t\tthis.open_btn.dispatchEvent(new Event('click'));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t}\r\n\t\r\n\t_initAction(action) {\r\n\t\t/** -------------------------- COMMON ----------------------------- */\r\n\t\tthis._findVariables();\r\n\t\tthis._findElements();\r\n\t\t/** -------------------------- END COMMON ----------------------------- */\r\n\t\tif (action === 'open') {\r\n\t\t\t/** -------------------------- OPEN ----------------------------- */\r\n\t\t\tconst mainHandler = (arg) => {\r\n\t\t\t\tthis._createAvailableFontsList()\r\n\t\t\t\t\t.then((response) => {\r\n\t\t\t\t\t\tthis._attachEvents(response);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis._createDownloadedFontsList(response)\r\n\t\t\t\t\t\t\t.then(list => {\r\n\t\t\t\t\t\t\t\tconsole.log(list);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.finally(setLoader(false));\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * Проверить, содержит ли таблица fonts записи и если нет, сделать\r\n\t\t\t * запрос на сервер\r\n\t\t\t * */\r\n\t\t\tconst transaction = this.indDB._transaction([this.options.available_fonts_store_name, this.options.downloaded_fonts_store_name]);\r\n\t\t\ttransaction.objectStore(this.options.available_fonts_store_name)\r\n\t\t\t\t.count().onsuccess = (e) => {\r\n\t\t\t\t\tif (!e.target.result) {\r\n\t\t\t\t\t\tlet request = {\r\n\t\t\t\t\t\t\taction: 'get_font'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet contentHandler = (data) => {\r\n\t\t\t\t\t\t\tthis.indDB.setStoreData([this.options.available_fonts_store_name], [data])\r\n\t\t\t\t\t\t\t\t.then(resolve => {\r\n\t\t\t\t\t\t\t\t\t// console.log(resolve);\r\n\t\t\t\t\t\t\t\t\tmainHandler();\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.catch(err => console.error(err));\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tgetFetchResponse(request)\r\n\t\t\t\t\t\t\t.then(data => contentHandler(data));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmainHandler();\r\n\t\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ttransaction.objectStore(this.options.downloaded_fonts_store_name)\r\n\t\t\t\t.count().onsuccess = (e) => {\r\n\t\t\t\t\tif (e.target.result) {\r\n\t\t\t\t\t\t/* TODO: НА этом месте функция вывода уже выбранных и загруженных шрифтов */\r\n\t\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t/** -------------------------- END OPEN ----------------------------- */\r\n\t\t} else if (action === 'delete') {\r\n\t\t\t/** -------------------------- DELETE ----------------------------- */\r\n\t\t\tthis.search_fieldset.setAttribute('disabled', 'disabled');\r\n\t\t\tthis.available_fonts_list_items = this.search_input.value = null;\r\n\t\t\tthis.available_fonts_list.innerHTML = this.count_items.innerHTML = '';\r\n\t\t\tthis.main_holder.setAttribute('hidden', '');\r\n\t\t\tsetLoader(false);\r\n\t\t\t/** -------------------------- END DELETE ----------------------------- */\r\n\t\t}\r\n\t}\r\n\t\r\n\t_findVariables() {\r\n\t\tthis.GWH_url = 'https://google-webfonts-helper.herokuapp.com/api/fonts';\r\n\t\tthis.font_detalis_id_prefix = this.options.font_detalis_id_prefix || 'GWH_font_details_';\r\n\t\tthis.fonts_path = this.options.fonts_path || '/assets/fonts/';\r\n\t}\r\n\t\r\n\t_findElements() {\r\n\t\tthis.search_form = document.querySelector(this.options.search_form || '#GWH_search_form');\r\n\t\tthis.search_fieldset = document.querySelector(this.options.search_fieldset || '#GWH_search_fieldset');\r\n\t\tthis.search_input = document.querySelector(this.options.search_input || '#GWH_search_input');\r\n\t\tthis.subset_select = document.querySelector(this.options.subset_select || '#GWH_subset_select');\r\n\t\tthis.category_select = document.querySelector(this.options.category_select || '#GWH_category_select');\r\n\t\tthis.count_items = document.querySelector(this.options.count_items || '#GWH_count_items');\r\n\t\tthis.main_holder = document.querySelector(this.options.main_holder || '#GWH_main_holder');\r\n\t\tthis.available_fonts_list = document.querySelector(this.options.available_fonts_list || '#GWH_available_fonts_list');\r\n\t\tthis.downloaded_fonts_list = document.querySelector(this.options.downloaded_fonts_list || '#GWH_downloaded_fonts_list');\r\n\t}\r\n\t\r\n\t_createAvailableFontsList() {\r\n\t\tconst callback_observer = (entries, observer) => {\r\n\t\t\tentries.forEach(entry => {\r\n\t\t\t\tif (entry.isIntersecting) {\r\n\t\t\t\t\tdocument.head.insertAdjacentHTML('beforeend',\r\n\t\t\t\t\t\t`<link rel=\"stylesheet\" href=\"https://fonts.googleapis.com/css2?family=${entry.target.dataset.query}\">`);\r\n\t\t\t\t\t\r\n\t\t\t\t\tobserver.unobserve(entry.target);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\t\t\r\n\t\tconst observer = new IntersectionObserver(callback_observer, {rootMargin: '100% 0px 100% 0px'});\r\n\t\tconst categories = new Set();\r\n\t\tconst subsets = new Set();\r\n\t\t\r\n\t\tconst getSubsetsText = (value) => {\r\n\t\t\tlet subsets_text = '';\r\n\t\t\tvalue.subsets.forEach((s) => {\r\n\t\t\t\tsubsets.add(s);\r\n\t\t\t\tlet subset_class = 'alert-text';\r\n\t\t\t\tif (SUBSETS_PANGRAMS[s]) {\r\n\t\t\t\t\tsubset_class = s;\r\n\t\t\t\t\tif (RTL_SUBSETS.includes(s)) subset_class += ' rtl';\r\n\t\t\t\t}\r\n\t\t\t\tsubsets_text += `<p class=\"${subset_class}\">${SUBSETS_PANGRAMS[s] || 'no pangram for this language'}</p>`;\r\n\t\t\t});\r\n\t\t\treturn subsets_text;\r\n\t\t}\r\n\t\t\r\n\t\tconst getVariants = (value) => {\r\n\t\t\tlet variants = '';\r\n\t\t\tif (value.variants.length === 1 && value.defVariant !== 'regular') {\r\n\t\t\t\tif (value.defVariant === 'italic') {\r\n\t\t\t\t\tvariants = ':ital,wght@1,400';\r\n\t\t\t\t} else variants = ':wght@' + value.defVariant;\r\n\t\t\t} else if (!value.variants.includes('regular')) {\r\n\t\t\t\tvariants = ':wght@' + value.defVariant;\r\n\t\t\t}\r\n\t\t\treturn variants;\r\n\t\t}\r\n\t\t\r\n\t\tconst createItem = (value) => {\r\n\t\t\tlet variants = getVariants(value);\r\n\t\t\tlet subsets_text = getSubsetsText(value);\r\n\t\t\t\r\n\t\t\tlet link = document.createElement('a');\r\n\t\t\tlink.className = 'font-summary';\r\n\t\t\tlink.href = '#' + this.font_detalis_id_prefix + value.id;\r\n\t\t\tlink.innerHTML = `<h3 class=\"title\">\"${value.family}\"</h3>${subsets_text}`;\r\n\t\t\t\r\n\t\t\tlet details = document.createElement('div');\r\n\t\t\tdetails.className = 'font-details';\r\n\t\t\tdetails.id = this.font_detalis_id_prefix + value.id;\r\n\t\t\tdetails.setAttribute('hidden', '');\r\n\t\t\t\r\n\t\t\tlet item = document.createElement('li');\r\n\t\t\titem.style.fontFamily = `'${value.family}'`;\r\n\t\t\titem.dataset.query = value.family.split(' ').join('+') + variants + '&display=swap';\r\n\t\t\titem.dataset.id = value.id;\r\n\t\t\titem.append(...[link, details])\r\n\t\t\t\r\n\t\t\tobserver.observe(item);\r\n\t\t\treturn item;\r\n\t\t}\r\n\t\t\r\n\t\tdocument.head.insertAdjacentHTML('beforeend',\r\n\t\t\t'<link rel=\"preconnect\" href=\"https://fonts.gstatic.com\">');\r\n\t\t\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tconst available_fonts_list_items = {};\r\n\t\t\tconst store_name = this.options.available_fonts_store_name;\r\n\t\t\tconst request = this.indDB._transaction(store_name).objectStore(store_name).openCursor();\r\n\t\t\t\r\n\t\t\trequest.onsuccess = (e) => {\r\n\t\t\t\tlet cursor = e.target.result;\r\n\t\t\t\tif (cursor) {\r\n\t\t\t\t\tlet value = cursor.value;\r\n\t\t\t\t\t\r\n\t\t\t\t\tcategories.add(value.category);\r\n\t\t\t\t\t\r\n\t\t\t\t\tavailable_fonts_list_items[value.id] = createItem(value);\r\n\t\t\t\t\tcursor.continue();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresolve([available_fonts_list_items, subsets, categories]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t_attachEvents(response) {\r\n\t\tlet [available_fonts_list_items, subsets, categories] = response;\r\n\t\tlet prefix = 'subset-';\r\n\t\t\r\n\t\tthis.available_fonts_list_items = available_fonts_list_items;\r\n\t\t\r\n\t\tthis.search_fieldset.removeAttribute('disabled');\r\n\t\tthis.main_holder.removeAttribute('hidden');\r\n\t\t\r\n\t\tlet categories_options = [...categories]\r\n\t\t\t.sort((a, b) => a.localeCompare(b))\r\n\t\t\t.map(c => new Option(c, c))\r\n\t\t\t.reverse();\r\n\t\tthis.category_select.append(...categories_options);\r\n\t\t\r\n\t\tlet subsets_options = [...subsets]\r\n\t\t\t.sort((a, b) => a.localeCompare(b))\r\n\t\t\t.map(s => new Option(s, s));\r\n\t\tthis.subset_select.append(...subsets_options);\r\n\t\t\r\n\t\tconst searchFonts = (list) => {\r\n\t\t\tconst searchInKeys = (value, list) => {\r\n\t\t\t\tif (!value && this.search_input.value) value = this.search_input.value;\r\n\t\t\t\tthis.available_fonts_list.innerHTML = this.count_items.innerHTML = '';\r\n\t\t\t\t\r\n\t\t\t\tconst fragment = document.createDocumentFragment();\r\n\t\t\t\t\r\n\t\t\t\tlet matches = list.filter(s => (s.family.toLowerCase()).includes(value.toLowerCase()));\r\n\t\t\t\tthis.count_items.append(matches.length);\r\n\t\t\t\t\r\n\t\t\t\tmatches.forEach((item) => {\r\n\t\t\t\t\tfragment.appendChild(this.available_fonts_list_items[item.id]);\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tthis.available_fonts_list.append(fragment);\r\n\t\t\t\tsetLoader(false);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tsearchInKeys('', list);\r\n\t\t\t['focus', 'input'].forEach(evt =>\r\n\t\t\t\tthis.search_input.addEventListener(evt, (e) => {\r\n\t\t\t\t\tsearchInKeys(e.target.value, list);\r\n\t\t\t\t}, false)\r\n\t\t\t);\r\n\t\t}\r\n\t\t\r\n\t\tthis.indDB.getAllData({store: this.options.available_fonts_store_name})\r\n\t\t\t.then(result => searchFonts(result));\r\n\t\t\r\n\t\tthis.subset_select.onchange = (e) => {\r\n\t\t\tthis.indDB.getAllData({\r\n\t\t\t\tstore: this.options.available_fonts_store_name,\r\n\t\t\t\tcondition: !!e.target.selectedIndex,\r\n\t\t\t\tindex: 'subsets',\r\n\t\t\t\tvalue: !!e.target.selectedIndex ? e.target.value : null\r\n\t\t\t}).then(result => {\r\n\t\t\t\t[...this.available_fonts_list.classList].forEach(className => {\r\n\t\t\t\t\tif (className.startsWith(prefix)) this.available_fonts_list.classList.remove(className);\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tif (e.target.selectedIndex) {\r\n\t\t\t\t\tthis.available_fonts_list.classList.add(prefix + e.target.value);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (this.category_select.selectedIndex) {\r\n\t\t\t\t\tresult = result.filter(elem => elem['category'] === this.category_select.value);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tsearchFonts(result);\r\n\t\t\t\t\r\n\t\t\t\tObject.values(this.available_fonts_list_items).forEach((item) => {\r\n\t\t\t\t\tif (item.classList.contains('has-details')) {\r\n\t\t\t\t\t\titem.classList.remove('has-details', 'active');\r\n\t\t\t\t\t\titem.querySelector('.font-details').innerHTML = '';\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tthis.category_select.onchange = (e) => {\r\n\t\t\tthis.indDB.getAllData({\r\n\t\t\t\tstore: this.options.available_fonts_store_name,\r\n\t\t\t\tcondition: !!e.target.selectedIndex,\r\n\t\t\t\tindex: 'category',\r\n\t\t\t\tvalue: !!e.target.selectedIndex ? e.target.value : null\r\n\t\t\t}).then(result => {\r\n\t\t\t\tif (this.subset_select.selectedIndex) {\r\n\t\t\t\t\tresult = result.filter(elem => elem.subsets.includes(this.subset_select.value));\r\n\t\t\t\t}\r\n\t\t\t\tsearchFonts(result);\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tthis.search_form.onreset = () => {\r\n\t\t\tsetLoader();\r\n\t\t\t[...this.available_fonts_list.classList].forEach(className => {\r\n\t\t\t\tif (className.startsWith(prefix)) this.available_fonts_list.classList.remove(className);\r\n\t\t\t});\r\n\t\t\tthis.indDB.getAllData({store: this.options.available_fonts_store_name})\r\n\t\t\t\t.then(result => searchFonts(result));\r\n\t\t}\r\n\t\t\r\n\t\tthis.available_fonts_list.onclick = (e) => {\r\n\t\t\tlet link = e.target.closest('a');\r\n\t\t\tif (!link) return;\r\n\t\t\te.preventDefault();\r\n\t\t\t\r\n\t\t\tthis._createFontFamily(link);\r\n\t\t}\r\n\t}\r\n\t\r\n\t_createFontFamily(link) {\r\n\t\tconst item = link.parentElement;\r\n\t\tconst font_id = item.dataset.id;\r\n\t\tconst font_details = item.querySelector(link.getAttribute('href'));\r\n\t\t\r\n\t\tconst subsetsCheckboxes = (result) => {\r\n\t\t\treturn result.subsets.map((s) => {\r\n\t\t\t\tlet checkbox = document.createElement('input');\r\n\t\t\t\tcheckbox.type = 'checkbox';\r\n\t\t\t\tcheckbox.value = s;\r\n\t\t\t\tif (s === result.defSubset || s === this.subset_select.value) {\r\n\t\t\t\t\tcheckbox.setAttribute('checked', '');\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlet label = document.createElement('label');\r\n\t\t\t\tlabel.innerText = s;\r\n\t\t\t\tlabel.prepend(checkbox);\r\n\t\t\t\t\r\n\t\t\t\treturn label;\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tconst subsetsFieldset = (checkboxes) => {\r\n\t\t\tconst fieldset = document.createElement('div');\r\n\t\t\tfieldset.className = 'subsets-holder';\r\n\t\t\tfieldset.innerHTML = `<h4 class=\"subsets-title\">Subsets</h4>`;\r\n\t\t\tfieldset.append(...checkboxes);\r\n\t\t\t/*checkboxes.forEach((c, i, arr) => {\r\n\t\t\t\tfieldset.append(c);\r\n\t\t\t\tif (++i !== arr.length) fieldset.append(', ');\r\n\t\t\t});*/\r\n\t\t\treturn fieldset;\r\n\t\t}\r\n\t\t\r\n\t\tconst variantItem = (result, v, subsets) => {\r\n\t\t\tconst fieldset = document.createElement('li');\r\n\t\t\tfieldset.className = 'variation-holder';\r\n\t\t\tObject.assign(fieldset.style, {...VARIANTS_EXPLICATION[v]});\r\n\t\t\t\r\n\t\t\tconst link = document.createElement('a');\r\n\t\t\tlink.style.color = 'green';\r\n\t\t\tlink.href = `${this.GWH_url + '/' + result.id}?download=zip&variants=${v}&formats=woff2`;\r\n\t\t\tlink.innerText = 'download';\r\n\t\t\tlink.className = 'variation-download-link';\r\n\t\t\tlink.setAttribute('download', '');\r\n\t\t\tlink.onclick = (e) => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\t\r\n\t\t\t\tsetLoader();\r\n\t\t\t\tthis._downloadFont(result, v, subsets, e)\r\n\t\t\t\t\t.then(response => {\r\n\t\t\t\t\t\t// console.log(response);\r\n\t\t\t\t\t\tthis._createDownloadedFontsList(response)\r\n\t\t\t\t\t\t\t.then(list => {\r\n\t\t\t\t\t\t\t\tconsole.log(list);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(e => console.error(e))\r\n\t\t\t\t\t.finally(() => {setLoader(false)});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst variation_title = document.createElement('h4');\r\n\t\t\tvariation_title.className = 'variation-title';\r\n\t\t\tvariation_title.innerText = WEIGHT_NAME[VARIANTS_EXPLICATION[v].fontWeight] +\r\n\t\t\t\t(VARIANTS_EXPLICATION[v].fontStyle ? ' '+VARIANTS_EXPLICATION[v].fontStyle : '') +\r\n\t\t\t\t' . . . . . ';\r\n\t\t\t\r\n\t\t\tvariation_title.appendChild(link);\r\n\t\t\t\r\n\t\t\tlet subset = result.defSubset;\r\n\t\t\tif (this.subset_select.selectedIndex) {\r\n\t\t\t\tsubset = this.subset_select.value;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst text = document.createElement('p');\r\n\t\t\ttext.innerText = SUBSETS_PANGRAMS[subset];\r\n\t\t\ttext.className = 'variation-subset-text';\r\n\t\t\tif (RTL_SUBSETS.some((rtl) => rtl === subset)) text.className = 'rtl';\r\n\t\t\t\r\n\t\t\tfieldset.append(...[variation_title, text]);\r\n\t\t\t\r\n\t\t\treturn fieldset;\r\n\t\t}\r\n\t\t\r\n\t\tconst familyDOM = (result) => {\r\n\t\t\tconst fragment = document.createDocumentFragment();\r\n\t\t\tconst variantsList = document.createElement('ul');\r\n\t\t\tconst subsets_checkboxes = subsetsCheckboxes(result);\r\n\t\t\t\r\n\t\t\tsortVariants(result.variants).forEach((v) => {\r\n\t\t\t\tvariantsList.appendChild(variantItem(result, v, subsets_checkboxes));\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tfragment.append(...[subsetsFieldset(subsets_checkboxes), variantsList]);\r\n\t\t\treturn fragment;\r\n\t\t}\r\n\t\t\r\n\t\tconst familyCss = (result) => {\r\n\t\t\tlet query = result.family.split(' ').join('+');\r\n\t\t\tlet wghts = [];\r\n\t\t\tlet style = false;\r\n\t\t\t\r\n\t\t\tif (result.variants.some((v) => v.endsWith('italic'))) {\r\n\t\t\t\tstyle = true;\r\n\t\t\t\tquery += ':ital';\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tresult.variants.forEach((i) => {\r\n\t\t\t\tif (style) {\r\n\t\t\t\t\twghts.push((VARIANTS_EXPLICATION[i].fontStyle ? '1' : '0') + ',' + VARIANTS_EXPLICATION[i].fontWeight);\r\n\t\t\t\t} else wghts.push(VARIANTS_EXPLICATION[i].fontWeight);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tif (wghts.length) {\r\n\t\t\t\tquery += (style ? ',' : ':') + 'wght@' + wghts.sort((a, b) => a.localeCompare(b)).join(';');\r\n\t\t\t}\r\n\t\t\tquery += '&display=swap';\r\n\t\t\t\r\n\t\t\treturn `<link rel=\"stylesheet\" href=\"https://fonts.googleapis.com/css2?family=${query}\">`;\r\n\t\t}\r\n\t\t\r\n\t\tPromise.resolve()\r\n\t\t\t.then(async () => {\r\n\t\t\t\tif (!item.classList.contains('has-details')) {\r\n\t\t\t\t\tawait this.indDB.getAllData({\r\n\t\t\t\t\t\tstore: this.options.available_fonts_store_name,\r\n\t\t\t\t\t\tvalue: font_id\r\n\t\t\t\t\t}).then(r => {\r\n\t\t\t\t\t\tlet [result] = r;\r\n\t\t\t\t\t\tfont_details.innerHTML = '';\r\n\t\t\t\t\t\tfont_details.appendChild(familyDOM(result));\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (!item.classList.contains('foreign-css-downloaded')) {\r\n\t\t\t\t\t\t\tdocument.head.insertAdjacentHTML('beforeend', familyCss(result));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.then(() => {\r\n\t\t\t\tthis.available_fonts_list.childNodes.forEach(n => n.classList.remove('active'));\r\n\t\t\t\titem.classList.add('active', 'has-details', 'foreign-css-downloaded');\r\n\t\t\t\twindow.scroll({\r\n\t\t\t\t\ttop: window.scrollY + item.getBoundingClientRect().top - (document.getElementById('GWH_search_form').offsetHeight + 10),\r\n\t\t\t\t\tleft: 0,\r\n\t\t\t\t\tbehavior: 'smooth'});\r\n\t\t\t});\r\n\t\t\r\n\t}\r\n\t\r\n\t_downloadFont(result, variant, subsets, e) {\r\n\t\tconst checked_subsets = [].filter.call(subsets, (c) => c.control.checked).map(c => c.control.value);\r\n\t\tconst store_name = this.options.downloaded_fonts_store_name;\r\n\t\t\r\n\t\tif (checked_subsets.length) {\r\n\t\t\te.target.href = `${this.GWH_url + '/' + result.id}?download=zip&subsets=${checked_subsets.join(',')}&variants=${variant}&formats=woff2`;\r\n\t\t}\r\n\t\t\r\n\t\tconst request = {\r\n\t\t\taction: 'get_font',\r\n\t\t\tfont: e.target.getAttribute('href').replace(this.GWH_url + '/', ''),\r\n\t\t\tinfo: {\r\n\t\t\t\tfamily: result.family\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tconst get_store = (resolve, reject, data) => {\r\n\t\t\treturn this.indDB._transaction(store_name, {\r\n\t\t\t\tcomplete: () => {resolve(data)},\r\n\t\t\t\terror: (e) => {reject(e)}\r\n\t\t\t}, 'readwrite').objectStore(store_name);\r\n\t\t}\r\n\t\t\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.indDB._transaction(store_name)\r\n\t\t\t\t.objectStore(store_name)\r\n\t\t\t\t.get(result.id)\r\n\t\t\t\t.onsuccess = (e) => {\r\n\t\t\t\tlet result = e.target.result;\r\n\t\t\t\t\r\n\t\t\t\tif (!checked_subsets.length) {\r\n\t\t\t\t\treject(`Chose the subset(s), please!`); return;\r\n\t\t\t\t}\r\n\t\t\t\tif (!result) {\r\n\t\t\t\t\tgetFetchResponse(request)\r\n\t\t\t\t\t\t.then(data => {\r\n\t\t\t\t\t\t\tget_store(resolve, reject, data)\r\n\t\t\t\t\t\t\t\t.add(data.font);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(!(variant in result.variants)){\r\n\t\t\t\t\t\tgetFetchResponse(request)\r\n\t\t\t\t\t\t\t.then(data => {\r\n\t\t\t\t\t\t\t\tlet store = get_store(resolve, reject, data);\r\n\t\t\t\t\t\t\t\tObject.assign(result.variants, data.font.variants);\r\n\t\t\t\t\t\t\t\tstore.put(result);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet result_subsets = result.variants[variant].subsets.split(',');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (checked_subsets.length !== result_subsets.length ||\r\n\t\t\t\t\t\t\t(checked_subsets.filter(s => !result_subsets.includes(s))).length) {\r\n\t\t\t\t\t\t\tgetFetchResponse({\r\n\t\t\t\t\t\t\t\taction: 'delete_font',\r\n\t\t\t\t\t\t\t\tfont: result.variants[variant].files\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\t\t\t\tgetFetchResponse(request)\r\n\t\t\t\t\t\t\t\t\t\t.then(data => {\r\n\t\t\t\t\t\t\t\t\t\t\tlet store = get_store(resolve, reject, data);\r\n\t\t\t\t\t\t\t\t\t\t\tObject.assign(result.variants, data.font.variants);\r\n\t\t\t\t\t\t\t\t\t\t\tstore.put(result);\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else reject(`The font ${result.family + ' ' + variant} is exists!`);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t_createDownloadedFontsList() {\r\n\t\tconst fragment = document.createDocumentFragment();\r\n\t\t\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tconst downloaded_font_face = [];\r\n\t\t\tconst downloaded_fonts_list_items = {};\r\n\t\t\tconst store_name = this.options.downloaded_fonts_store_name;\r\n\t\t\tconst request = this.indDB._transaction(store_name).objectStore(store_name).openCursor();\r\n\t\t\t\r\n\t\t\trequest.onsuccess = (e) => {\r\n\t\t\t\tlet cursor = e.target.result;\r\n\t\t\t\tif (cursor) {\r\n\t\t\t\t\tlet value = cursor.value;\r\n\t\t\t\t\tlet variants = Object.keys(value.variants);\r\n\t\t\t\t\tlet fonts = document.createElement('ul');\r\n\t\t\t\t\tfonts.className = 'font-downloaded-details';\r\n\t\t\t\t\tfonts.id = this.font_detalis_id_prefix + '_downloaded_' + value.id;\r\n\t\t\t\t\tfonts.setAttribute('hidden', '');\r\n\t\t\t\t\t\r\n\t\t\t\t\tsortVariants(variants).forEach((v) => {\r\n\t\t\t\t\t\tconst subsets = (value.variants[v].subsets).split(',');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst var_del_link = document.createElement('a');\r\n\t\t\t\t\t\tvar_del_link.className = 'variation-delete-link';\r\n\t\t\t\t\t\tvar_del_link.innerText = 'delete';\r\n\t\t\t\t\t\tvar_del_link.title = 'delete variation';\r\n\t\t\t\t\t\tvar_del_link.href = window.location.origin + this.fonts_path + value.variants[v].files[0];\r\n\t\t\t\t\t\tvar_del_link.onclick = (e) => {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tgetFetchResponse({\r\n\t\t\t\t\t\t\t\taction: 'delete_font',\r\n\t\t\t\t\t\t\t\tfont: value.variants[v].files\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.then((data) => {\r\n\t\t\t\t\t\t\t\t\tlet store = this.indDB._transaction(store_name, {\r\n\t\t\t\t\t\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\t\t\t\t\t\tthis._createDownloadedFontsList(data)\r\n\t\t\t\t\t\t\t\t\t\t\t\t.then(list => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(list);\r\n\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}, 'readwrite').objectStore(store_name);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (variants.length > 1) {\r\n\t\t\t\t\t\t\t\t\t\tdelete value.variants[v];\r\n\t\t\t\t\t\t\t\t\t\tstore.put(value);\r\n\t\t\t\t\t\t\t\t\t} else store.delete(value.id);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst var_title = document.createElement('h4');\r\n\t\t\t\t\t\tvar_title.className = 'variation-title';\r\n\t\t\t\t\t\tvar_title.innerHTML = `${\r\n\t\t\t\t\t\t\tWEIGHT_NAME[VARIANTS_EXPLICATION[v].fontWeight] +\r\n\t\t\t\t\t\t\t(VARIANTS_EXPLICATION[v].fontStyle ? ' ' + VARIANTS_EXPLICATION[v].fontStyle : '')\r\n\t\t\t\t\t\t} <small>${subsets.join('</small>, <small>')}</small>`;\r\n\t\t\t\t\t\tvar_title.appendChild(var_del_link);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst font = document.createElement('li');\r\n\t\t\t\t\t\tObject.assign(font.style, VARIANTS_EXPLICATION[v]);\r\n\t\t\t\t\t\tfont.className = 'variation-holder';\r\n\t\t\t\t\t\tfont.dataset.variant = v;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tfont.appendChild(var_title);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tsubsets.forEach((s) => {\r\n\t\t\t\t\t\t\tlet subset_class = RTL_SUBSETS.includes(s) ? s + ' rtl' : s;\r\n\t\t\t\t\t\t\tfont.insertAdjacentHTML('beforeend',\r\n\t\t\t\t\t\t\t\t`<p class=\"${subset_class}\">${SUBSETS_PANGRAMS[s] || 'no pangram for this language'}</p>`);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tfonts.appendChild(font);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet font_face_variant = (\r\n\t\t\t\t\t\t\t({fontWeight, fontStyle = 'normal'}) => ({weight: fontWeight, style: fontStyle})\r\n\t\t\t\t\t\t)(VARIANTS_EXPLICATION[v]);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet font_face = new FontFace(String(value.family).split(' ').join('-') + '-downloaded',\r\n\t\t\t\t\t\t\t`url(${this.fonts_path + value.variants[v].files[0]})`,\r\n\t\t\t\t\t\t\tObject.assign(font_face_variant, {display: 'swap'})\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdownloaded_font_face.push(font_face);\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet count_variants = variants.length > 1 ? ` <sup>${variants.length}</sup>` : '';\r\n\t\t\t\t\tconst fam_del_link = document.createElement('a');\r\n\t\t\t\t\tfam_del_link.className = 'family-delete-link';\r\n\t\t\t\t\tfam_del_link.innerText = '❌' /*'␡'*/;\r\n\t\t\t\t\tfam_del_link.title = 'delete family';\r\n\t\t\t\t\tfam_del_link.href = '#';\r\n\t\t\t\t\tfam_del_link.onclick = (e) => {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tgetFetchResponse({\r\n\t\t\t\t\t\t\taction: 'delete_font',\r\n\t\t\t\t\t\t\tfont: Object.values(value.variants).map(f => f.files).flat()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\t\t\tthis.indDB._transaction(store_name, {\r\n\t\t\t\t\t\t\t\t\tcomplete: (data) => {\r\n\t\t\t\t\t\t\t\t\t\tthis._createDownloadedFontsList(data)\r\n\t\t\t\t\t\t\t\t\t\t\t.then(list => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(list);\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}, 'readwrite').objectStore(store_name).delete(value.id);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst open_close_link = document.createElement('a');\r\n\t\t\t\t\topen_close_link.className = 'open-close-link';\r\n\t\t\t\t\topen_close_link.href = '#' + this.font_detalis_id_prefix + '_downloaded_' + value.id;\r\n\t\t\t\t\topen_close_link.innerHTML = `${value.family + count_variants}`;\r\n\t\t\t\t\topen_close_link.onclick = (e) => {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tArray.from(this.downloaded_fonts_list.querySelectorAll('.font-downloaded-details'))\r\n\t\t\t\t\t\t\t.filter(f => f !== fonts)\r\n\t\t\t\t\t\t\t.forEach(f => {f.setAttribute('hidden', '')});\r\n\t\t\t\t\t\tArray.from(this.downloaded_fonts_list.querySelectorAll('.open-close-link'))\r\n\t\t\t\t\t\t\t.filter(l => l !== open_close_link)\r\n\t\t\t\t\t\t\t.forEach(l => l.classList.remove('active'));\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (fonts.hasAttribute('hidden')){\r\n\t\t\t\t\t\t\tfonts.removeAttribute('hidden');\r\n\t\t\t\t\t\t\topen_close_link.classList.add('active');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfonts.setAttribute('hidden', '');\r\n\t\t\t\t\t\t\topen_close_link.classList.remove('active');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst title = document.createElement('h3');\r\n\t\t\t\t\ttitle.className = 'title';\r\n\t\t\t\t\ttitle.append(...[open_close_link, fam_del_link]);\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst item = document.createElement('li');\r\n\t\t\t\t\titem.style.fontFamily = String(value.family).split(' ').join('-') + '-downloaded';\r\n\t\t\t\t\titem.dataset.id = value.id;\r\n\t\t\t\t\titem.append(...[title, fonts]);\r\n\t\t\t\t\t\r\n\t\t\t\t\tfragment.appendChild(item);\r\n\t\t\t\t\t\r\n\t\t\t\t\tcursor.continue();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdownloaded_font_face.forEach((font) => {\r\n\t\t\t\t\t\tfont.load().then(function(loaded_face) {\r\n\t\t\t\t\t\t\tdocument.fonts.add(loaded_face)\r\n\t\t\t\t\t\t}).catch(function(error) {\r\n\t\t\t\t\t\t\tconsole.error(error);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.downloaded_fonts_list.innerHTML = '';\r\n\t\t\t\t\tthis.downloaded_fonts_list.appendChild(fragment);\r\n\t\t\t\t\tresolve(downloaded_fonts_list_items);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nwindow.GWHelper = GWHelper;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]}