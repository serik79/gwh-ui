{"version":3,"sources":["main.js"],"names":["asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","arguments","apply","err","undefined","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","_objectSpread","target","i","length","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","configurable","writable","SUBSETS_PANGRAMS","RTL_SUBSETS","WEIGHT_NAME","VARIANTS_EXPLICATION","reloadPage","getFetchResponse","setLoader","sortVariants","IndDB","GWHelper","constructor","options","upgrade","e","db","result","onerror","console","oldVersion","store","createObjectStore","available_fonts_store_name","keyPath","createIndex","unique","multiEntry","downloaded_fonts_store_name","success","onversionchange","close","warn","db_name","input_url","db_version","assign","init","indDB","_ref","open_btn","document","querySelector","delete_btn","togglePlugin","disable","enable","setAttribute","addEventListener","open_db_options","response","catch","message","once","removeAttribute","_initAction","indexedDB","databases","name","version","dispatchEvent","Event","action","_findVariables","_findElements","mainHandler","_createAvailableFontsList","_attachEvents","_createDownloadedFontsList","list","log","finally","transaction","_transaction","objectStore","count","onsuccess","contentHandler","data","setStoreData","search_fieldset","available_fonts_list_items","search_input","available_fonts_list","innerHTML","count_items","main_holder","GWH_url","font_detalis_id_prefix","fonts_path","search_form","subset_select","category_select","downloaded_fonts_list","observer","IntersectionObserver","entries","entry","isIntersecting","head","insertAdjacentHTML","concat","dataset","query","unobserve","rootMargin","categories","Set","subsets","createItem","variants","defVariant","includes","getVariants","subsets_text","s","add","subset_class","getSubsetsText","link","createElement","className","href","id","family","details","item","style","fontFamily","split","join","append","observe","store_name","openCursor","cursor","category","continue","prefix","categories_options","sort","a","b","localeCompare","map","c","Option","reverse","subsets_options","searchFonts","searchInKeys","fragment","createDocumentFragment","matches","toLowerCase","appendChild","evt","getAllData","onchange","condition","selectedIndex","index","classList","startsWith","remove","elem","values","contains","onreset","onclick","closest","preventDefault","_createFontFamily","_this","parentElement","font_id","font_details","getAttribute","subsetsCheckboxes","checkbox","type","defSubset","label","innerText","prepend","variantItem","v","fieldset","color","stopPropagation","_downloadFont","variation_title","fontWeight","fontStyle","subset","text","some","rtl","r","checkboxes","variantsList","subsets_checkboxes","familyDOM","wghts","endsWith","familyCss","childNodes","n","window","scroll","top","scrollY","getBoundingClientRect","getElementById","offsetHeight","left","behavior","variant","checked_subsets","call","control","checked","request","font","replace","get_store","complete","get","result_subsets","files","put","downloaded_font_face","downloaded_fonts_list_items","fonts","open_close_link","var_del_link","title","location","origin","delete","var_title","font_face_variant","_ref3","weight","font_face","FontFace","String","display","count_variants","fam_del_link","f","flat","Array","from","querySelectorAll","l","hasAttribute","load","loaded_face"],"mappings":"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","file":"../js/main.min.js","sourcesContent":["'use strict';\r\n\r\nimport {SUBSETS_PANGRAMS, RTL_SUBSETS, WEIGHT_NAME, VARIANTS_EXPLICATION} from './modules/constants.min.js';\r\nimport {reloadPage, getFetchResponse, setLoader, sortVariants} from './modules/helpers.min.js';\r\nimport {IndDB} from './modules/indexeddb.min.js';\r\n\r\n\r\nclass GWHelper {\r\n\t\r\n\t/** private const */\r\n\topen_db_options = {\r\n\t\tupgrade: (e, obj) => {\r\n\t\t\tlet db = e.target.result;\r\n\t\t\tdb.onerror = (err) => console.error('ERROR IN \"REQUEST_DB.onupgradeneeded\": ', err.target.error || err);\r\n\t\t\tif (e.oldVersion < 1) {\r\n\t\t\t\tlet store = db.createObjectStore(this.options.available_fonts_store_name, {keyPath: 'id'});\r\n\t\t\t\tstore.createIndex(\"family\", \"family\", {unique: true});\r\n\t\t\t\t// store.createIndex(\"variants\", \"variants\", {unique: false});\r\n\t\t\t\tstore.createIndex(\"subsets\", \"subsets\", {unique: false, multiEntry: true});\r\n\t\t\t\tstore.createIndex(\"category\", \"category\", {unique: false});\r\n\t\t\t\t// store.createIndex(\"defSubset\", \"defSubset\", {unique: false});\r\n\t\t\t\t// store.createIndex(\"defVariant\", \"defVariant\", {unique: false});\r\n\t\t\t\t\r\n\t\t\t\tstore = db.createObjectStore(this.options.downloaded_fonts_store_name, {keyPath: 'id'});\r\n\t\t\t\tstore.createIndex(\"variants\", \"variants\", {unique: false, multiEntry: true});\r\n\t\t\t}\r\n\t\t},\r\n\t\tsuccess: (e) => {\r\n\t\t\tlet db = e.target.result;\r\n\t\t\t/** TODO: display in warnings */\r\n\t\t\tdb.onerror = (err) => console.error('ERROR IN \"REQUEST_DB.onsuccess\": ', err.target.error || err);\r\n\t\t\tdb.onversionchange = () => {\r\n\t\t\t\tdb.close();\r\n\t\t\t\tconsole.warn('%cThe database is out of date 👴 please reload the page.', 'color:red;font-size:30px');\r\n\t\t\t\treloadPage();\r\n\t\t\t}\r\n\t\t\treturn db;\r\n\t\t}\r\n\t}\r\n\t\r\n\tconstructor(options) {\r\n\t\tthis.options = {\r\n\t\t\tavailable_fonts_store_name: 'available_fonts',\r\n\t\t\tdownloaded_fonts_store_name: 'downloaded_fonts',\r\n\t\t\tdb_name: 'fontsDB',\r\n\t\t\tinput_url: 'ajax.php',\r\n\t\t\tdb_version: 1,\r\n\t\t}\r\n\t\tObject.assign(this.options, options);\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tinit() {\r\n\t\t/**\r\n\t\t * Using Object Destructuring and Property Shorthand 👏👏👏\r\n\t\t * https://stackoverflow.com/questions/17781472/how-to-get-a-subset-of-a-javascript-objects-properties\r\n\t\t * ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓\r\n\t\t * */\r\n\t\tthis.indDB = new IndDB((({db_name, db_version}) => ({db_name, db_version}))(this.options));\r\n\t\tthis.open_btn = document.querySelector(this.options.open_btn || '#GWH_open_btn');\r\n\t\tthis.delete_btn = document.querySelector(this.options.delete_btn || '#GWH_delete_btn');\r\n\t\t\r\n\t\tlet togglePlugin = (disable, enable) => {\r\n\t\t\tsetLoader();\r\n\t\t\tthis[disable +'_btn'].setAttribute('disabled', 'disabled');\r\n\t\t\tthis[enable +'_btn'].addEventListener('click', () => {\r\n\t\t\t\tthis.indDB[enable](this.open_db_options)\r\n\t\t\t\t\t.then(response => {\r\n\t\t\t\t\t\ttogglePlugin(enable, disable);\r\n\t\t\t\t\t\tconsole.info(response)\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\tconsole.error(err.message)\r\n\t\t\t\t\t});\r\n\t\t\t}, {once: true});\r\n\t\t\tthis[enable +'_btn'].removeAttribute('disabled');\r\n\t\t\tthis._initAction(disable);\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * Проверка на существование базы данных и если нет, вывод кнопки с запуском плагина\r\n\t\t * по событию click с дальнейшим отключением кнопки\r\n\t\t * TODO: возможно поменять способ инит при загрузке с существующей базой\r\n\t\t * */\r\n\t\tindexedDB.databases()\r\n\t\t\t.then(response => {\r\n\t\t\t\ttogglePlugin('delete', 'open');\r\n\t\t\t\tif (!!(response.filter(db => db.name === this.options.db_name && db.version === this.options.db_version)).length) {\r\n\t\t\t\t\tthis.open_btn.dispatchEvent(new Event('click'));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t}\r\n\t\r\n\t_initAction(action) {\r\n\t\t/** -------------------------- COMMON ----------------------------- */\r\n\t\tthis._findVariables();\r\n\t\tthis._findElements();\r\n\t\t/** -------------------------- END COMMON ----------------------------- */\r\n\t\tif (action === 'open') {\r\n\t\t\t/** -------------------------- OPEN ----------------------------- */\r\n\t\t\tconst mainHandler = (arg) => {\r\n\t\t\t\tthis._createAvailableFontsList()\r\n\t\t\t\t\t.then((response) => {\r\n\t\t\t\t\t\tthis._attachEvents(response);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis._createDownloadedFontsList(response)\r\n\t\t\t\t\t\t\t.then(list => {\r\n\t\t\t\t\t\t\t\tconsole.log(list);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.finally(setLoader(false));\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tconst transaction = this.indDB._transaction([this.options.available_fonts_store_name, this.options.downloaded_fonts_store_name]);\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * Проверить, содержит ли таблица available_fonts записи и если нет, сделать\r\n\t\t\t * запрос на сервер\r\n\t\t\t * */\r\n\t\t\ttransaction.objectStore(this.options.available_fonts_store_name)\r\n\t\t\t\t.count().onsuccess = (e) => {\r\n\t\t\t\t\tif (!e.target.result) {\r\n\t\t\t\t\t\tlet request = {\r\n\t\t\t\t\t\t\taction: 'get_font'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet contentHandler = (data) => {\r\n\t\t\t\t\t\t\tthis.indDB.setStoreData([this.options.available_fonts_store_name], [data])\r\n\t\t\t\t\t\t\t\t.then(resolve => {\r\n\t\t\t\t\t\t\t\t\t// console.log(resolve);\r\n\t\t\t\t\t\t\t\t\tmainHandler();\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.catch(err => console.error(err));\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tgetFetchResponse(request, this.input_url)\r\n\t\t\t\t\t\t\t.then(data => contentHandler(data))\r\n\t\t\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t\t\t\t\tsetLoader(false);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmainHandler();\r\n\t\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * Проверить, содержит ли таблица downloaded_fonts записи и если нет, сделать\r\n\t\t\t * запрос на сервер\r\n\t\t\t * */\r\n\t\t\ttransaction.objectStore(this.options.downloaded_fonts_store_name)\r\n\t\t\t\t.count().onsuccess = (e) => {\r\n\t\t\t\t\tif (e.target.result) {\r\n\t\t\t\t\t\t/* TODO: НА этом месте функция вывода уже выбранных и загруженных шрифтов */\r\n\t\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t/** -------------------------- END OPEN ----------------------------- */\r\n\t\t} else if (action === 'delete') {\r\n\t\t\t/** -------------------------- DELETE ----------------------------- */\r\n\t\t\tthis.search_fieldset.setAttribute('disabled', 'disabled');\r\n\t\t\tthis.available_fonts_list_items = this.search_input.value = null;\r\n\t\t\tthis.available_fonts_list.innerHTML = this.count_items.innerHTML = '';\r\n\t\t\tthis.main_holder.setAttribute('hidden', '');\r\n\t\t\tsetLoader(false);\r\n\t\t\t/** -------------------------- END DELETE ----------------------------- */\r\n\t\t}\r\n\t}\r\n\t\r\n\t_findVariables() {\r\n\t\tthis.GWH_url = 'https://google-webfonts-helper.herokuapp.com/api/fonts';\r\n\t\tthis.font_detalis_id_prefix = this.options.font_detalis_id_prefix || 'GWH_font_details_';\r\n\t\tthis.fonts_path = this.options.fonts_path || '/assets/fonts/';\r\n\t\tthis.input_url = this.options.input_url || 'ajax.php';\r\n\t}\r\n\t\r\n\t_findElements() {\r\n\t\tthis.search_form = document.querySelector(this.options.search_form || '#GWH_search_form');\r\n\t\tthis.search_fieldset = document.querySelector(this.options.search_fieldset || '#GWH_search_fieldset');\r\n\t\tthis.search_input = document.querySelector(this.options.search_input || '#GWH_search_input');\r\n\t\tthis.subset_select = document.querySelector(this.options.subset_select || '#GWH_subset_select');\r\n\t\tthis.category_select = document.querySelector(this.options.category_select || '#GWH_category_select');\r\n\t\tthis.count_items = document.querySelector(this.options.count_items || '#GWH_count_items');\r\n\t\tthis.main_holder = document.querySelector(this.options.main_holder || '#GWH_main_holder');\r\n\t\tthis.available_fonts_list = document.querySelector(this.options.available_fonts_list || '#GWH_available_fonts_list');\r\n\t\tthis.downloaded_fonts_list = document.querySelector(this.options.downloaded_fonts_list || '#GWH_downloaded_fonts_list');\r\n\t}\r\n\t\r\n\t_createAvailableFontsList() {\r\n\t\tconst callback_observer = (entries, observer) => {\r\n\t\t\tentries.forEach(entry => {\r\n\t\t\t\tif (entry.isIntersecting) {\r\n\t\t\t\t\tdocument.head.insertAdjacentHTML('beforeend',\r\n\t\t\t\t\t\t`<link rel=\"stylesheet\" href=\"https://fonts.googleapis.com/css2?family=${entry.target.dataset.query}\">`);\r\n\t\t\t\t\t\r\n\t\t\t\t\tobserver.unobserve(entry.target);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\t\t\r\n\t\tconst observer = new IntersectionObserver(callback_observer, {rootMargin: '100% 0px 100% 0px'});\r\n\t\tconst categories = new Set();\r\n\t\tconst subsets = new Set();\r\n\t\t\r\n\t\tconst getSubsetsText = (value) => {\r\n\t\t\tlet subsets_text = '';\r\n\t\t\tvalue.subsets.forEach((s) => {\r\n\t\t\t\tsubsets.add(s);\r\n\t\t\t\tlet subset_class = 'alert-text';\r\n\t\t\t\tif (SUBSETS_PANGRAMS[s]) {\r\n\t\t\t\t\tsubset_class = s;\r\n\t\t\t\t\tif (RTL_SUBSETS.includes(s)) subset_class += ' rtl';\r\n\t\t\t\t}\r\n\t\t\t\tsubsets_text += `<p class=\"${subset_class}\">${SUBSETS_PANGRAMS[s] || 'no pangram for this language'}</p>`;\r\n\t\t\t});\r\n\t\t\treturn subsets_text;\r\n\t\t}\r\n\t\t\r\n\t\tconst getVariants = (value) => {\r\n\t\t\tlet variants = '';\r\n\t\t\tif (value.variants.length === 1 && value.defVariant !== 'regular') {\r\n\t\t\t\tif (value.defVariant === 'italic') {\r\n\t\t\t\t\tvariants = ':ital,wght@1,400';\r\n\t\t\t\t} else variants = ':wght@' + value.defVariant;\r\n\t\t\t} else if (!value.variants.includes('regular')) {\r\n\t\t\t\tvariants = ':wght@' + value.defVariant;\r\n\t\t\t}\r\n\t\t\treturn variants;\r\n\t\t}\r\n\t\t\r\n\t\tconst createItem = (value) => {\r\n\t\t\tlet variants = getVariants(value);\r\n\t\t\tlet subsets_text = getSubsetsText(value);\r\n\t\t\t\r\n\t\t\tlet link = document.createElement('a');\r\n\t\t\tlink.className = 'font-summary';\r\n\t\t\tlink.href = '#' + this.font_detalis_id_prefix + value.id;\r\n\t\t\tlink.innerHTML = `<h3 class=\"title\">\"${value.family}\"</h3>${subsets_text}`;\r\n\t\t\t\r\n\t\t\tlet details = document.createElement('div');\r\n\t\t\tdetails.className = 'font-details';\r\n\t\t\tdetails.id = this.font_detalis_id_prefix + value.id;\r\n\t\t\tdetails.setAttribute('hidden', '');\r\n\t\t\t\r\n\t\t\tlet item = document.createElement('li');\r\n\t\t\titem.style.fontFamily = `'${value.family}'`;\r\n\t\t\titem.dataset.query = value.family.split(' ').join('+') + variants + '&display=swap';\r\n\t\t\titem.dataset.id = value.id;\r\n\t\t\titem.append(...[link, details])\r\n\t\t\t\r\n\t\t\tobserver.observe(item);\r\n\t\t\treturn item;\r\n\t\t}\r\n\t\t\r\n\t\tdocument.head.insertAdjacentHTML('beforeend',\r\n\t\t\t'<link rel=\"preconnect\" href=\"https://fonts.gstatic.com\">');\r\n\t\t\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tconst available_fonts_list_items = {};\r\n\t\t\tconst store_name = this.options.available_fonts_store_name;\r\n\t\t\tconst request = this.indDB._transaction(store_name).objectStore(store_name).openCursor();\r\n\t\t\t\r\n\t\t\trequest.onsuccess = (e) => {\r\n\t\t\t\tlet cursor = e.target.result;\r\n\t\t\t\tif (cursor) {\r\n\t\t\t\t\tlet value = cursor.value;\r\n\t\t\t\t\t\r\n\t\t\t\t\tcategories.add(value.category);\r\n\t\t\t\t\t\r\n\t\t\t\t\tavailable_fonts_list_items[value.id] = createItem(value);\r\n\t\t\t\t\tcursor.continue();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresolve([available_fonts_list_items, subsets, categories]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t_attachEvents(response) {\r\n\t\tlet [available_fonts_list_items, subsets, categories] = response;\r\n\t\tlet prefix = 'subset-';\r\n\t\t\r\n\t\tthis.available_fonts_list_items = available_fonts_list_items;\r\n\t\t\r\n\t\tthis.search_fieldset.removeAttribute('disabled');\r\n\t\tthis.main_holder.removeAttribute('hidden');\r\n\t\t\r\n\t\tlet categories_options = [...categories]\r\n\t\t\t.sort((a, b) => a.localeCompare(b))\r\n\t\t\t.map(c => new Option(c, c))\r\n\t\t\t.reverse();\r\n\t\tthis.category_select.append(...categories_options);\r\n\t\t\r\n\t\tlet subsets_options = [...subsets]\r\n\t\t\t.sort((a, b) => a.localeCompare(b))\r\n\t\t\t.map(s => new Option(s, s));\r\n\t\tthis.subset_select.append(...subsets_options);\r\n\t\t\r\n\t\tconst searchFonts = (list) => {\r\n\t\t\tconst searchInKeys = (value, list) => {\r\n\t\t\t\tif (!value && this.search_input.value) value = this.search_input.value;\r\n\t\t\t\tthis.available_fonts_list.innerHTML = this.count_items.innerHTML = '';\r\n\t\t\t\t\r\n\t\t\t\tconst fragment = document.createDocumentFragment();\r\n\t\t\t\t\r\n\t\t\t\tlet matches = list.filter(s => (s.family.toLowerCase()).includes(value.toLowerCase()));\r\n\t\t\t\tthis.count_items.append(matches.length);\r\n\t\t\t\t\r\n\t\t\t\tmatches.forEach((item) => {\r\n\t\t\t\t\tfragment.appendChild(this.available_fonts_list_items[item.id]);\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tthis.available_fonts_list.append(fragment);\r\n\t\t\t\tsetLoader(false);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tsearchInKeys('', list);\r\n\t\t\t['focus', 'input'].forEach(evt =>\r\n\t\t\t\tthis.search_input.addEventListener(evt, (e) => {\r\n\t\t\t\t\tsearchInKeys(e.target.value, list);\r\n\t\t\t\t}, false)\r\n\t\t\t);\r\n\t\t}\r\n\t\t\r\n\t\tthis.indDB.getAllData({store: this.options.available_fonts_store_name})\r\n\t\t\t.then(result => searchFonts(result));\r\n\t\t\r\n\t\tthis.subset_select.onchange = (e) => {\r\n\t\t\tthis.indDB.getAllData({\r\n\t\t\t\tstore: this.options.available_fonts_store_name,\r\n\t\t\t\tcondition: !!e.target.selectedIndex,\r\n\t\t\t\tindex: 'subsets',\r\n\t\t\t\tvalue: !!e.target.selectedIndex ? e.target.value : null\r\n\t\t\t}).then(result => {\r\n\t\t\t\t[...this.available_fonts_list.classList].forEach(className => {\r\n\t\t\t\t\tif (className.startsWith(prefix)) this.available_fonts_list.classList.remove(className);\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tif (e.target.selectedIndex) {\r\n\t\t\t\t\tthis.available_fonts_list.classList.add(prefix + e.target.value);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (this.category_select.selectedIndex) {\r\n\t\t\t\t\tresult = result.filter(elem => elem['category'] === this.category_select.value);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tsearchFonts(result);\r\n\t\t\t\t\r\n\t\t\t\tObject.values(this.available_fonts_list_items).forEach((item) => {\r\n\t\t\t\t\tif (item.classList.contains('has-details')) {\r\n\t\t\t\t\t\titem.classList.remove('has-details', 'active');\r\n\t\t\t\t\t\titem.querySelector('.font-details').innerHTML = '';\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tthis.category_select.onchange = (e) => {\r\n\t\t\tthis.indDB.getAllData({\r\n\t\t\t\tstore: this.options.available_fonts_store_name,\r\n\t\t\t\tcondition: !!e.target.selectedIndex,\r\n\t\t\t\tindex: 'category',\r\n\t\t\t\tvalue: !!e.target.selectedIndex ? e.target.value : null\r\n\t\t\t}).then(result => {\r\n\t\t\t\tif (this.subset_select.selectedIndex) {\r\n\t\t\t\t\tresult = result.filter(elem => elem.subsets.includes(this.subset_select.value));\r\n\t\t\t\t}\r\n\t\t\t\tsearchFonts(result);\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tthis.search_form.onreset = () => {\r\n\t\t\tsetLoader();\r\n\t\t\t[...this.available_fonts_list.classList].forEach(className => {\r\n\t\t\t\tif (className.startsWith(prefix)) this.available_fonts_list.classList.remove(className);\r\n\t\t\t});\r\n\t\t\tthis.indDB.getAllData({store: this.options.available_fonts_store_name})\r\n\t\t\t\t.then(result => searchFonts(result));\r\n\t\t}\r\n\t\t\r\n\t\tthis.available_fonts_list.onclick = (e) => {\r\n\t\t\tlet link = e.target.closest('a');\r\n\t\t\tif (!link) return;\r\n\t\t\te.preventDefault();\r\n\t\t\t\r\n\t\t\tthis._createFontFamily(link);\r\n\t\t}\r\n\t}\r\n\t\r\n\t_createFontFamily(link) {\r\n\t\tconst item = link.parentElement;\r\n\t\tconst font_id = item.dataset.id;\r\n\t\tconst font_details = item.querySelector(link.getAttribute('href'));\r\n\t\t\r\n\t\tconst subsetsCheckboxes = (result) => {\r\n\t\t\treturn result.subsets.map((s) => {\r\n\t\t\t\tlet checkbox = document.createElement('input');\r\n\t\t\t\tcheckbox.type = 'checkbox';\r\n\t\t\t\tcheckbox.value = s;\r\n\t\t\t\tif (s === result.defSubset || s === this.subset_select.value) {\r\n\t\t\t\t\tcheckbox.setAttribute('checked', '');\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlet label = document.createElement('label');\r\n\t\t\t\tlabel.innerText = s;\r\n\t\t\t\tlabel.prepend(checkbox);\r\n\t\t\t\t\r\n\t\t\t\treturn label;\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tconst subsetsFieldset = (checkboxes) => {\r\n\t\t\tconst fieldset = document.createElement('div');\r\n\t\t\tfieldset.className = 'subsets-holder';\r\n\t\t\tfieldset.innerHTML = `<h4 class=\"subsets-title\">Subsets</h4>`;\r\n\t\t\tfieldset.append(...checkboxes);\r\n\t\t\t/*checkboxes.forEach((c, i, arr) => {\r\n\t\t\t\tfieldset.append(c);\r\n\t\t\t\tif (++i !== arr.length) fieldset.append(', ');\r\n\t\t\t});*/\r\n\t\t\treturn fieldset;\r\n\t\t}\r\n\t\t\r\n\t\tconst variantItem = (result, v, subsets) => {\r\n\t\t\tconst fieldset = document.createElement('li');\r\n\t\t\tfieldset.className = 'variation-holder';\r\n\t\t\tObject.assign(fieldset.style, {...VARIANTS_EXPLICATION[v]});\r\n\t\t\t\r\n\t\t\tconst link = document.createElement('a');\r\n\t\t\tlink.style.color = 'green';\r\n\t\t\tlink.href = `${this.GWH_url + '/' + result.id}?download=zip&variants=${v}&formats=woff2`;\r\n\t\t\tlink.innerText = 'download';\r\n\t\t\tlink.className = 'variation-download-link';\r\n\t\t\tlink.setAttribute('download', '');\r\n\t\t\tlink.onclick = (e) => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\t\r\n\t\t\t\tsetLoader();\r\n\t\t\t\tthis._downloadFont(result, v, subsets, e)\r\n\t\t\t\t\t.then(response => {\r\n\t\t\t\t\t\t// console.log(response);\r\n\t\t\t\t\t\tthis._createDownloadedFontsList(response)\r\n\t\t\t\t\t\t\t.then(list => {\r\n\t\t\t\t\t\t\t\tconsole.log(list);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(e => console.error(e))\r\n\t\t\t\t\t.finally(() => {setLoader(false)});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst variation_title = document.createElement('h4');\r\n\t\t\tvariation_title.className = 'variation-title';\r\n\t\t\tvariation_title.innerText = WEIGHT_NAME[VARIANTS_EXPLICATION[v].fontWeight] +\r\n\t\t\t\t(VARIANTS_EXPLICATION[v].fontStyle ? ' '+VARIANTS_EXPLICATION[v].fontStyle : '') +\r\n\t\t\t\t' . . . . . ';\r\n\t\t\t\r\n\t\t\tvariation_title.appendChild(link);\r\n\t\t\t\r\n\t\t\tlet subset = result.defSubset;\r\n\t\t\tif (this.subset_select.selectedIndex) {\r\n\t\t\t\tsubset = this.subset_select.value;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst text = document.createElement('p');\r\n\t\t\ttext.innerText = SUBSETS_PANGRAMS[subset];\r\n\t\t\ttext.className = 'variation-subset-text';\r\n\t\t\tif (RTL_SUBSETS.some((rtl) => rtl === subset)) text.className = 'rtl';\r\n\t\t\t\r\n\t\t\tfieldset.append(...[variation_title, text]);\r\n\t\t\t\r\n\t\t\treturn fieldset;\r\n\t\t}\r\n\t\t\r\n\t\tconst familyDOM = (result) => {\r\n\t\t\tconst fragment = document.createDocumentFragment();\r\n\t\t\tconst variantsList = document.createElement('ul');\r\n\t\t\tconst subsets_checkboxes = subsetsCheckboxes(result);\r\n\t\t\t\r\n\t\t\tsortVariants(result.variants).forEach((v) => {\r\n\t\t\t\tvariantsList.appendChild(variantItem(result, v, subsets_checkboxes));\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tfragment.append(...[subsetsFieldset(subsets_checkboxes), variantsList]);\r\n\t\t\treturn fragment;\r\n\t\t}\r\n\t\t\r\n\t\tconst familyCss = (result) => {\r\n\t\t\tlet query = result.family.split(' ').join('+');\r\n\t\t\tlet wghts = [];\r\n\t\t\tlet style = false;\r\n\t\t\t\r\n\t\t\tif (result.variants.some((v) => v.endsWith('italic'))) {\r\n\t\t\t\tstyle = true;\r\n\t\t\t\tquery += ':ital';\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tresult.variants.forEach((i) => {\r\n\t\t\t\tif (style) {\r\n\t\t\t\t\twghts.push((VARIANTS_EXPLICATION[i].fontStyle ? '1' : '0') + ',' + VARIANTS_EXPLICATION[i].fontWeight);\r\n\t\t\t\t} else wghts.push(VARIANTS_EXPLICATION[i].fontWeight);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tif (wghts.length) {\r\n\t\t\t\tquery += (style ? ',' : ':') + 'wght@' + wghts.sort((a, b) => a.localeCompare(b)).join(';');\r\n\t\t\t}\r\n\t\t\tquery += '&display=swap';\r\n\t\t\t\r\n\t\t\treturn `<link rel=\"stylesheet\" href=\"https://fonts.googleapis.com/css2?family=${query}\">`;\r\n\t\t}\r\n\t\t\r\n\t\tPromise.resolve()\r\n\t\t\t.then(async () => {\r\n\t\t\t\tif (!item.classList.contains('has-details')) {\r\n\t\t\t\t\tawait this.indDB.getAllData({\r\n\t\t\t\t\t\tstore: this.options.available_fonts_store_name,\r\n\t\t\t\t\t\tvalue: font_id\r\n\t\t\t\t\t}).then(r => {\r\n\t\t\t\t\t\tlet [result] = r;\r\n\t\t\t\t\t\tfont_details.innerHTML = '';\r\n\t\t\t\t\t\tfont_details.appendChild(familyDOM(result));\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (!item.classList.contains('foreign-css-downloaded')) {\r\n\t\t\t\t\t\t\tdocument.head.insertAdjacentHTML('beforeend', familyCss(result));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.then(() => {\r\n\t\t\t\tthis.available_fonts_list.childNodes.forEach(n => n.classList.remove('active'));\r\n\t\t\t\titem.classList.add('active', 'has-details', 'foreign-css-downloaded');\r\n\t\t\t\twindow.scroll({\r\n\t\t\t\t\ttop: window.scrollY + item.getBoundingClientRect().top - (document.getElementById('GWH_search_form').offsetHeight + 10),\r\n\t\t\t\t\tleft: 0,\r\n\t\t\t\t\tbehavior: 'smooth'});\r\n\t\t\t});\r\n\t\t\r\n\t}\r\n\t\r\n\t_downloadFont(result, variant, subsets, e) {\r\n\t\tconst checked_subsets = [].filter.call(subsets, (c) => c.control.checked).map(c => c.control.value);\r\n\t\tconst store_name = this.options.downloaded_fonts_store_name;\r\n\t\t\r\n\t\tif (checked_subsets.length) {\r\n\t\t\te.target.href = `${this.GWH_url + '/' + result.id}?download=zip&subsets=${checked_subsets.join(',')}&variants=${variant}&formats=woff2`;\r\n\t\t}\r\n\t\t\r\n\t\tconst request = {\r\n\t\t\taction: 'get_font',\r\n\t\t\tfont: e.target.getAttribute('href').replace(this.GWH_url + '/', ''),\r\n\t\t\tinfo: {\r\n\t\t\t\tfamily: result.family\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tconst get_store = (resolve, reject, data) => {\r\n\t\t\treturn this.indDB._transaction(store_name, {\r\n\t\t\t\tcomplete: () => {resolve(data)},\r\n\t\t\t\terror: (e) => {reject(e)}\r\n\t\t\t}, 'readwrite').objectStore(store_name);\r\n\t\t}\r\n\t\t\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.indDB._transaction(store_name)\r\n\t\t\t\t.objectStore(store_name)\r\n\t\t\t\t.get(result.id)\r\n\t\t\t\t.onsuccess = (e) => {\r\n\t\t\t\tlet result = e.target.result;\r\n\t\t\t\t\r\n\t\t\t\tif (!checked_subsets.length) {\r\n\t\t\t\t\treject(`Chose the subset(s), please!`); return;\r\n\t\t\t\t}\r\n\t\t\t\tif (!result) {\r\n\t\t\t\t\tgetFetchResponse(request, this.input_url)\r\n\t\t\t\t\t\t.then(data => {\r\n\t\t\t\t\t\t\tget_store(resolve, reject, data)\r\n\t\t\t\t\t\t\t\t.add(data.font);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t\t\t\tsetLoader(false);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(!(variant in result.variants)){\r\n\t\t\t\t\t\tgetFetchResponse(request, this.input_url)\r\n\t\t\t\t\t\t\t.then(data => {\r\n\t\t\t\t\t\t\t\tlet store = get_store(resolve, reject, data);\r\n\t\t\t\t\t\t\t\tObject.assign(result.variants, data.font.variants);\r\n\t\t\t\t\t\t\t\tstore.put(result);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t\t\t\t\tsetLoader(false);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet result_subsets = result.variants[variant].subsets.split(',');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (checked_subsets.length !== result_subsets.length ||\r\n\t\t\t\t\t\t\t(checked_subsets.filter(s => !result_subsets.includes(s))).length) {\r\n\t\t\t\t\t\t\tgetFetchResponse({\r\n\t\t\t\t\t\t\t\taction: 'delete_font',\r\n\t\t\t\t\t\t\t\tfont: result.variants[variant].files\r\n\t\t\t\t\t\t\t}, this.input_url)\r\n\t\t\t\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\t\t\t\tgetFetchResponse(request, this.input_url)\r\n\t\t\t\t\t\t\t\t\t\t.then(data => {\r\n\t\t\t\t\t\t\t\t\t\t\tlet store = get_store(resolve, reject, data);\r\n\t\t\t\t\t\t\t\t\t\t\tObject.assign(result.variants, data.font.variants);\r\n\t\t\t\t\t\t\t\t\t\t\tstore.put(result);\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t\t\t\t\t\t\t\tsetLoader(false);\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t\t\t\t\t\tsetLoader(false);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else reject(`The font ${result.family + ' ' + variant} is exists!`);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t_createDownloadedFontsList() {\r\n\t\tconst fragment = document.createDocumentFragment();\r\n\t\t\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tconst downloaded_font_face = [];\r\n\t\t\tconst downloaded_fonts_list_items = {};\r\n\t\t\tconst store_name = this.options.downloaded_fonts_store_name;\r\n\t\t\tconst request = this.indDB._transaction(store_name).objectStore(store_name).openCursor();\r\n\t\t\t\r\n\t\t\trequest.onsuccess = (e) => {\r\n\t\t\t\tlet cursor = e.target.result;\r\n\t\t\t\tif (cursor) {\r\n\t\t\t\t\tlet value = cursor.value;\r\n\t\t\t\t\tlet variants = Object.keys(value.variants);\r\n\t\t\t\t\tlet fonts = document.createElement('ul');\r\n\t\t\t\t\tfonts.className = 'font-downloaded-details';\r\n\t\t\t\t\tfonts.id = this.font_detalis_id_prefix + '_downloaded_' + value.id;\r\n\t\t\t\t\tfonts.setAttribute('hidden', '');\r\n\t\t\t\t\tconst open_close_link = document.createElement('a');\r\n\t\t\t\t\t\r\n\t\t\t\t\tsortVariants(variants).forEach((v) => {\r\n\t\t\t\t\t\tconst subsets = (value.variants[v].subsets).split(',');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst var_del_link = document.createElement('a');\r\n\t\t\t\t\t\tvar_del_link.className = 'variation-delete-link';\r\n\t\t\t\t\t\tvar_del_link.innerText = 'delete';\r\n\t\t\t\t\t\tvar_del_link.title = 'delete variation';\r\n\t\t\t\t\t\tvar_del_link.href = window.location.origin + this.fonts_path + value.variants[v].files[0];\r\n\t\t\t\t\t\tvar_del_link.onclick = (e) => {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tgetFetchResponse({\r\n\t\t\t\t\t\t\t\taction: 'delete_font',\r\n\t\t\t\t\t\t\t\tfont: value.variants[v].files\r\n\t\t\t\t\t\t\t}, this.input_url)\r\n\t\t\t\t\t\t\t\t.then((data) => {\r\n\t\t\t\t\t\t\t\t\tlet store = this.indDB._transaction(store_name, {\r\n\t\t\t\t\t\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\t\t\t\t\t\tthis._createDownloadedFontsList(data)\r\n\t\t\t\t\t\t\t\t\t\t\t\t.then(list => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(list);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/** TODO: make the open-close link open and scroll back */\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// if (open_close_link) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// \tconsole.log(open_close_link);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// \topen_close_link.dispatchEvent(new Event('click'));\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}, 'readwrite').objectStore(store_name);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (variants.length > 1) {\r\n\t\t\t\t\t\t\t\t\t\tdelete value.variants[v];\r\n\t\t\t\t\t\t\t\t\t\tstore.put(value);\r\n\t\t\t\t\t\t\t\t\t} else store.delete(value.id);\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t\t\t\t\t\tsetLoader(false);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst var_title = document.createElement('h4');\r\n\t\t\t\t\t\tvar_title.className = 'variation-title';\r\n\t\t\t\t\t\tvar_title.innerHTML = `${\r\n\t\t\t\t\t\t\tWEIGHT_NAME[VARIANTS_EXPLICATION[v].fontWeight] +\r\n\t\t\t\t\t\t\t(VARIANTS_EXPLICATION[v].fontStyle ? ' ' + VARIANTS_EXPLICATION[v].fontStyle : '')\r\n\t\t\t\t\t\t} <small>${subsets.join('</small>, <small>')}</small>`;\r\n\t\t\t\t\t\tvar_title.appendChild(var_del_link);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst font = document.createElement('li');\r\n\t\t\t\t\t\tObject.assign(font.style, VARIANTS_EXPLICATION[v]);\r\n\t\t\t\t\t\tfont.className = 'variation-holder';\r\n\t\t\t\t\t\tfont.dataset.variant = v;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tfont.appendChild(var_title);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tsubsets.forEach((s) => {\r\n\t\t\t\t\t\t\tlet subset_class = RTL_SUBSETS.includes(s) ? s + ' rtl' : s;\r\n\t\t\t\t\t\t\tfont.insertAdjacentHTML('beforeend',\r\n\t\t\t\t\t\t\t\t`<p class=\"${subset_class}\">${SUBSETS_PANGRAMS[s] || 'no pangram for this language'}</p>`);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tfonts.appendChild(font);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet font_face_variant = (\r\n\t\t\t\t\t\t\t({fontWeight, fontStyle = 'normal'}) => ({weight: fontWeight, style: fontStyle})\r\n\t\t\t\t\t\t)(VARIANTS_EXPLICATION[v]);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet font_face = new FontFace(String(value.family).split(' ').join('-') + '-downloaded',\r\n\t\t\t\t\t\t\t`url(${this.fonts_path + value.variants[v].files[0]})`,\r\n\t\t\t\t\t\t\tObject.assign(font_face_variant, {display: 'swap'})\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdownloaded_font_face.push(font_face);\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet count_variants = variants.length > 1 ? ` <sup>${variants.length}</sup>` : '';\r\n\t\t\t\t\tconst fam_del_link = document.createElement('a');\r\n\t\t\t\t\tfam_del_link.className = 'family-delete-link';\r\n\t\t\t\t\tfam_del_link.innerText = '❌' /*'␡'*/;\r\n\t\t\t\t\tfam_del_link.title = 'delete family';\r\n\t\t\t\t\tfam_del_link.href = '#';\r\n\t\t\t\t\tfam_del_link.onclick = (e) => {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tgetFetchResponse({\r\n\t\t\t\t\t\t\taction: 'delete_font',\r\n\t\t\t\t\t\t\tfont: Object.values(value.variants).map(f => f.files).flat()\r\n\t\t\t\t\t\t}, this.input_url)\r\n\t\t\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\t\t\tthis.indDB._transaction(store_name, {\r\n\t\t\t\t\t\t\t\t\tcomplete: (data) => {\r\n\t\t\t\t\t\t\t\t\t\tthis._createDownloadedFontsList(data)\r\n\t\t\t\t\t\t\t\t\t\t\t.then(list => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(list);\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}, 'readwrite').objectStore(store_name).delete(value.id);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t\t\t\t\tsetLoader(false);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// const open_close_link = document.createElement('a');\r\n\t\t\t\t\topen_close_link.className = 'open-close-link';\r\n\t\t\t\t\topen_close_link.href = '#' + this.font_detalis_id_prefix + '_downloaded_' + value.id;\r\n\t\t\t\t\topen_close_link.innerHTML = `${value.family + count_variants}`;\r\n\t\t\t\t\topen_close_link.onclick = (e) => {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tArray.from(this.downloaded_fonts_list.querySelectorAll('.font-downloaded-details'))\r\n\t\t\t\t\t\t\t.filter(f => f !== fonts)\r\n\t\t\t\t\t\t\t.forEach(f => {f.setAttribute('hidden', '')});\r\n\t\t\t\t\t\tArray.from(this.downloaded_fonts_list.querySelectorAll('.open-close-link'))\r\n\t\t\t\t\t\t\t.filter(l => l !== open_close_link)\r\n\t\t\t\t\t\t\t.forEach(l => l.classList.remove('active'));\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (fonts.hasAttribute('hidden')){\r\n\t\t\t\t\t\t\tfonts.removeAttribute('hidden');\r\n\t\t\t\t\t\t\topen_close_link.classList.add('active');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfonts.setAttribute('hidden', '');\r\n\t\t\t\t\t\t\topen_close_link.classList.remove('active');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst title = document.createElement('h3');\r\n\t\t\t\t\ttitle.className = 'title';\r\n\t\t\t\t\ttitle.append(...[open_close_link, fam_del_link]);\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst item = document.createElement('li');\r\n\t\t\t\t\titem.style.fontFamily = String(value.family).split(' ').join('-') + '-downloaded';\r\n\t\t\t\t\titem.dataset.id = value.id;\r\n\t\t\t\t\titem.append(...[title, fonts]);\r\n\t\t\t\t\t\r\n\t\t\t\t\tfragment.appendChild(item);\r\n\t\t\t\t\t\r\n\t\t\t\t\tcursor.continue();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdownloaded_font_face.forEach((font) => {\r\n\t\t\t\t\t\tfont.load().then(function(loaded_face) {\r\n\t\t\t\t\t\t\tdocument.fonts.add(loaded_face)\r\n\t\t\t\t\t\t}).catch(function(error) {\r\n\t\t\t\t\t\t\tconsole.error(error);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.downloaded_fonts_list.innerHTML = '';\r\n\t\t\t\t\tthis.downloaded_fonts_list.appendChild(fragment);\r\n\t\t\t\t\tresolve(downloaded_fonts_list_items);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nwindow.GWHelper = GWHelper;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]}