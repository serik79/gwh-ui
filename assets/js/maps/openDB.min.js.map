{"version":3,"sources":["openDB.js"],"names":["_openDB","db_name","db_version","available_fonts_store_name","downloaded_fonts_store_name","this","options","Promise","resolve","reject","REQUEST_DB","indexedDB","open","onupgradeneeded","e","db","target","result","onerror","err","console","error","oldVersion","store","createObjectStore","keyPath","createIndex","unique","multiEntry","onblocked","warn","onsuccess","onversionchange","close","reloadPage"],"mappings":"AAAA,SAASA,UACR,IAAIC,QACHA,EADGC,WAEHA,EAFGC,2BAGHA,EAHGC,4BAIHA,GACGC,KAAKC,QAOT,OAAO,IAAIC,SAAQ,CAACC,EAASC,KAC5B,IAAMC,EAAaC,UAAUC,KAAKX,EAASC,GAE3CQ,EAAWG,gBAAmBC,IAC7B,IAAIC,EAAKD,EAAEE,OAAOC,OAIlB,GAFAF,EAAGG,QAAWC,GAAQC,QAAQC,MAAM,0CAA2CF,EAAIH,OAAOK,OAASF,GAE/FL,EAAEQ,WAAa,EAAG,CACrB,IAAMC,EAAQR,EAAGS,kBAAkBnB,KAAKC,QAAQH,2BAA4B,CAACsB,QAAS,OACtFF,EAAMG,YAAY,SAAU,SAAU,CAACC,QAAQ,IAC/CJ,EAAMG,YAAY,WAAY,WAAY,CAACC,QAAQ,IACnDJ,EAAMG,YAAY,UAAW,UAAW,CAACC,QAAQ,EAAOC,YAAY,IACpEL,EAAMG,YAAY,WAAY,WAAY,CAACC,QAAQ,IACnDJ,EAAMG,YAAY,YAAa,YAAa,CAACC,QAAQ,IACrDJ,EAAMG,YAAY,aAAc,aAAc,CAACC,QAAQ,IAE9BZ,EAAGS,kBAAkBnB,KAAKC,QAAQF,4BAA6B,CAACqB,QAAS,OACjFC,YAAY,WAAY,WAAY,CAACC,QAAQ,EAAOC,YAAY,MAInFlB,EAAWQ,QAAWC,GAAQV,EAAOU,EAAIH,OAAOK,OAASF,GACzDT,EAAWmB,UAAaf,GAAMM,QAAQU,KAAK,kFAAmFhB,GAC9HJ,EAAWqB,UAAajB,IACvB,IAAIC,EAAKD,EAAEE,OAAOC,OAGlBF,EAAGG,QAAWC,GAAQC,QAAQC,MAAM,oCAAqCF,EAAIH,OAAOK,OAASF,GAE7FJ,EAAGiB,gBAAkB,KACpBjB,EAAGkB,QAEHb,QAAQU,KAAK,2DAA4D,4BACzEI,cAGD1B,EAAQO,cAKHf","file":"../modules/openDB.min.js","sourcesContent":["function _openDB() {\r\n\tlet {\r\n\t\tdb_name,\r\n\t\tdb_version,\r\n\t\tavailable_fonts_store_name,\r\n\t\tdownloaded_fonts_store_name\r\n\t} = this.options;\r\n\t\r\n\t/*return new Promise((resolve, reject) => {\r\n\t\tresolve(db_name);\r\n\t});*/\r\n\t\r\n\t\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst REQUEST_DB = indexedDB.open(db_name, db_version);\r\n\t\t\r\n\t\tREQUEST_DB.onupgradeneeded = (e) => {\r\n\t\t\tlet db = e.target.result;\r\n\t\t\t\r\n\t\t\tdb.onerror = (err) => console.error('ERROR IN \"REQUEST_DB.onupgradeneeded\": ', err.target.error || err);\r\n\t\t\t\r\n\t\t\tif (e.oldVersion < 1) {\r\n\t\t\t\tconst store = db.createObjectStore(this.options.available_fonts_store_name, {keyPath: 'id'});\r\n\t\t\t\tstore.createIndex(\"family\", \"family\", {unique: true});\r\n\t\t\t\tstore.createIndex(\"variants\", \"variants\", {unique: false});\r\n\t\t\t\tstore.createIndex(\"subsets\", \"subsets\", {unique: false, multiEntry: true});\r\n\t\t\t\tstore.createIndex(\"category\", \"category\", {unique: false});\r\n\t\t\t\tstore.createIndex(\"defSubset\", \"defSubset\", {unique: false});\r\n\t\t\t\tstore.createIndex(\"defVariant\", \"defVariant\", {unique: false});\r\n\t\t\t\t\r\n\t\t\t\tconst downloaded_store = db.createObjectStore(this.options.downloaded_fonts_store_name, {keyPath: 'id'});\r\n\t\t\t\tdownloaded_store.createIndex(\"variants\", \"variants\", {unique: false, multiEntry: true});\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tREQUEST_DB.onerror = (err) => reject(err.target.error || err);\r\n\t\tREQUEST_DB.onblocked = (e) => console.warn(\"Your database version can't be upgraded because the app is open somewhere else.\", e);\r\n\t\tREQUEST_DB.onsuccess = (e) => {\r\n\t\t\tlet db = e.target.result;\r\n\t\t\t\r\n\t\t\t/** TODO: display in warnings */\r\n\t\t\tdb.onerror = (err) => console.error('ERROR IN \"REQUEST_DB.onsuccess\": ', err.target.error || err);\r\n\t\t\t\r\n\t\t\tdb.onversionchange = () => {\r\n\t\t\t\tdb.close();\r\n\t\t\t\t// –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç–∞—Ä–µ–ª–∞ üë¥, –ø–æ–∂–∞–ª—É—Å—Ç–∞, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.\r\n\t\t\t\tconsole.warn('%cThe database is out of date üë¥ please reload the page.', 'color:red;font-size:30px');\r\n\t\t\t\treloadPage();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tresolve(db);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nexport {_openDB};"]}